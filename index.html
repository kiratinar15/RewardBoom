<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REWARD BOOM - System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #0b0e14; color: #f1f5f9; }
        .glass-card { background: #111827; border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1.5rem; }
        .admin-stat-card { border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.05); text-align: center; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body x-data="system()">

    <template x-if="currentPage === 'login'">
        <div class="min-h-screen flex items-center justify-center p-4 bg-[#0b0e14]">
            <div class="glass-card w-full max-w-md p-10 shadow-2xl border-white/5">
                <div class="flex justify-center mb-6">
                    <div class="bg-orange-500 p-4 rounded-2xl shadow-lg shadow-orange-500/20">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-center mb-2">Admin Login</h2>
                <p class="text-gray-500 text-center mb-8 text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase mb-2 block font-bold">Username</label>
                        <input type="text" value="adminboom" class="w-full bg-[#161b22] border border-white/10 rounded-xl px-4 py-3 focus:outline-none text-white">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase mb-2 block font-bold">Password</label>
                        <input type="password" x-model="passInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full bg-[#161b22] border border-white/10 rounded-xl px-4 py-3 focus:outline-none text-white">
                    </div>
                    <button @click="doLogin" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-500/30 flex items-center justify-center space-x-2 transition-all">
                        <span>‚ûú ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </button>
                    <button @click="currentPage = 'home'" class="w-full py-2 text-gray-500 text-xs hover:text-white transition-colors italic">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                </div>
            </div>
        </div>
    </template>

    <template x-if="currentPage === 'admin'">
        <div class="min-h-screen p-8 max-w-5xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <div class="flex items-center space-x-4">
                    <div class="bg-orange-500 p-2 rounded-lg shadow-lg shadow-orange-500/20">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold italic">Admin Panel</h1>
                        <p class="text-[10px] text-emerald-400 font-bold uppercase tracking-widest">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö: adminboom</p>
                    </div>
                </div>
                <button @click="logout" class="bg-gray-800 px-4 py-2 rounded-lg text-xs font-bold hover:bg-red-600 transition-all flex items-center space-x-2">
                    <span>‚ûú Logout</span>
                </button>
            </header>

            <div class="grid grid-cols-1 gap-6">
                <div class="glass-card p-8 border-white/5">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold flex items-center space-x-2 text-sm uppercase tracking-wider"><span>üìä</span> <span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span></h3>
                        <span class="text-[10px] bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full border border-emerald-500/20 font-bold italic">Online</span>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <template x-for="box in rewardData.slice(0, 4)">
                            <div class="admin-stat-card bg-white/[0.02] hover:bg-white/[0.05] transition-all cursor-pointer border-white/5">
                                <p class="text-[10px] text-gray-500 mb-2 uppercase" x-text="box.id"></p>
                                <p class="text-3xl font-black text-blue-400" x-text="box.total"></p>
                            </div>
                        </template>
                    </div>

                    <div class="space-y-3 pt-6 border-t border-white/5">
                        <div class="flex justify-between text-xs">
                            <span class="text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Box ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>
                            <span class="text-white font-bold" x-text="rewardData.length + ' ‡∏ä‡∏∏‡∏î'"></span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-gray-500">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</span>
                            <span class="text-emerald-400 font-bold">sp_mininap</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-8 border-orange-500/20">
                    <h3 class="font-bold mb-6 flex items-center space-x-2 text-orange-400 text-sm italic"><span>üîó</span> <span>Link Google Sheets ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></h3>
                    <div class="flex flex-col space-y-4">
                        <input type="text" x-model="csvUrl" class="w-full bg-[#0b0e14] border border-white/10 rounded-xl px-4 py-3 text-xs text-gray-400 font-mono focus:ring-1 focus:ring-orange-500 transition-all">
                        <button @click="saveUrl" class="bg-orange-500/10 text-orange-500 border border-orange-500/30 w-full py-4 rounded-xl font-bold hover:bg-orange-500 hover:text-white transition-all flex items-center justify-center space-x-2">
                            <span>üíæ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheets</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template x-if="currentPage === 'home'">
        <div class="flex h-screen overflow-hidden">
            <aside class="w-72 bg-[#111827] border-r border-white/5 flex flex-col">
                <div class="p-8">
                    <h2 class="text-xl font-black text-blue-500 italic tracking-tighter">REWARD BOOM</h2>
                    <p class="text-[10px] text-gray-600 uppercase font-bold tracking-[0.2em] mt-1">Analytics Dashboard</p>
                </div>
                
                <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                    <template x-for="box in rewardData" :key="box.id">
                        <button @click="changeTab(box.id)" 
                            :class="activeTab === box.id ? 'bg-blue-600/10 text-blue-400 border-l-4 border-blue-500' : 'text-gray-500 hover:bg-white/5'"
                            class="w-full flex flex-col px-5 py-4 text-sm rounded-xl transition-all">
                            <div class="flex justify-between w-full mb-1">
                                <span class="text-[10px] font-bold opacity-50 uppercase" x-text="box.id"></span>
                                <span class="text-xs font-mono" x-text="box.total"></span>
                            </div>
                            <div class="text-left truncate w-full font-medium" x-text="box.title"></div>
                        </button>
                    </template>
                </nav>

                <div class="p-6 border-t border-white/5">
                    <button @click="currentPage = 'login'" class="w-full bg-white/5 text-gray-500 py-3 rounded-xl text-xs font-bold hover:bg-white/10 hover:text-white transition-all">
                        üîí Admin Login
                    </button>
                </div>
            </aside>

            <main class="flex-1 flex flex-col bg-[#0b0e14]">
                <header class="bg-[#111827] px-8 py-5 flex justify-between items-center border-b border-white/5 shadow-xl">
                    <h1 class="text-lg font-bold text-white italic" x-text="getCurrentBox()?.title || 'Loading...'"></h1>
                    <div class="relative">
                        <input type="text" x-model="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°..." class="bg-[#0b0e14] border border-white/10 rounded-full px-6 py-2 text-sm text-white w-72 focus:ring-1 focus:ring-blue-500 transition-all shadow-inner">
                    </div>
                </header>

                <section class="flex-1 p-8 overflow-y-auto space-y-8">
                    <div class="glass-card p-8 shadow-2xl"><div style="height: 350px;"><canvas id="itemChart"></canvas></div></div>
                    
                    <div class="glass-card overflow-hidden shadow-2xl border-white/5">
                        <table class="w-full text-left">
                            <thead class="bg-white/[0.03] border-b border-white/5">
                                <tr class="text-gray-500 text-[10px] font-bold uppercase tracking-widest">
                                    <th class="px-8 py-5">REWARD ITEM (Vehicle/Skin)</th>
                                    <th class="px-8 py-5 text-center">REDEEM COUNT</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                <template x-for="item in filteredItems()" :key="item.name + item.sys">
                                    <tr class="hover:bg-blue-500/5 transition-colors group">
                                        <td class="px-8 py-5">
                                            <div class="text-sm font-bold text-gray-200 group-hover:text-white transition-colors" x-text="item.name"></div>
                                            <div class="text-[10px] text-gray-600 font-mono mt-0.5 uppercase tracking-tighter" x-text="item.sys"></div>
                                        </td>
                                        <td class="px-8 py-5 text-center text-xl font-black text-emerald-400 font-mono" x-text="item.count"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                        <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-10 flex justify-between items-center relative overflow-hidden">
                            <div class="absolute -right-5 -bottom-5 text-[10rem] opacity-10 font-black italic">TOTAL</div>
                            <div class="z-10">
                                <p class="text-[10px] text-blue-200 uppercase font-black tracking-widest mb-1">Grand Total Statistics</p>
                                <h3 class="text-white text-lg font-bold opacity-80" x-text="getCurrentBox()?.title"></h3>
                            </div>
                            <div class="text-right z-10 flex items-baseline space-x-2">
                                <span class="text-7xl font-black text-white tracking-tighter" x-text="getCurrentBox()?.total.toLocaleString() || 0"></span>
                                <span class="text-blue-100 font-black uppercase text-[10px] tracking-widest">TIMES</span>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </template>

    <script>
        function system() {
            return {
                currentPage: 'home', // 'home', 'login', 'admin'
                activeTab: '',
                search: '',
                passInput: '',
                rewardData: [],
                csvUrl: localStorage.getItem('rewardCsvUrl') || 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFrdwnCKV_cB0AECX2p47917IPmwoamAqO5ubOz9wbyXMOLA5eiGnKVSIXrW5zEg0PLzMH5903mXtO/pub?gid=0&single=true&output=csv',
                chartInstance: null,

                async init() {
                    await this.fetchData();
                },

                doLogin() {
                    if (this.passInput === '123') { // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°
                        this.currentPage = 'admin';
                        this.passInput = '';
                    } else {
                        alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    }
                },

                logout() { this.currentPage = 'home'; },

                saveUrl() {
                    if(!this.csvUrl.includes('output=csv')) {
                        alert('‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ output=csv ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö');
                        return;
                    }
                    localStorage.setItem('rewardCsvUrl', this.csvUrl);
                    location.reload();
                },

                async fetchData() {
                    try {
                        const res = await fetch(this.csvUrl + '&cb=' + Date.now());
                        const data = await res.text();
                        this.rewardData = this.parseCSV(data);
                        if (this.rewardData.length > 0) {
                            if (!this.activeTab) this.activeTab = this.rewardData[0].id;
                            this.$nextTick(() => this.renderChart());
                        }
                    } catch (e) { console.error("Fetch Error:", e); }
                },

                parseCSV(csv) {
                    const lines = csv.split(/\r?\n/).filter(l => l.trim() !== '');
                    const boxes = {};
                    lines.slice(1).forEach(line => {
                        const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        if (cols.length < 5) return;
                        const [boxId, title, itemName, sysName, count] = cols.map(s => s.replace(/"/g, '').trim());
                        if (!boxId) return;
                        if (!boxes[boxId]) boxes[boxId] = { id: boxId, title: title, items: [], total: 0 };
                        const val = parseInt(count) || 0;
                        boxes[boxId].items.push({ name: itemName, sys: sysName, count: val });
                        boxes[boxId].total += val;
                    });
                    return Object.values(boxes);
                },

                getCurrentBox() { return this.rewardData.find(b => b.id === this.activeTab); },
                
                filteredItems() { 
                    const box = this.getCurrentBox();
                    return box ? box.items.filter(i => i.name.toLowerCase().includes(this.search.toLowerCase())) : [];
                },
                
                changeTab(id) { 
                    this.activeTab = id; 
                    this.$nextTick(() => this.renderChart()); 
                },

                renderChart() {
                    const box = this.getCurrentBox();
                    if (!box) return;
                    const ctx = document.getElementById('itemChart').getContext('2d');
                    if (this.chartInstance) this.chartInstance.destroy();
                    this.chartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: box.items.map(i => i.name),
                            datasets: [{
                                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                                data: box.items.map(i => i.count),
                                backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444'],
                                borderRadius: 10,
                                barThickness: 25
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            scales: {
                                x: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#64748b' } },
                                y: { grid: { display: false }, ticks: { color: '#f1f5f9', font: { family: 'Kanit', size: 12 } } }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>
