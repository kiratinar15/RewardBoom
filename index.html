<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exchangeReward - Event Timeline Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #050505; color: #f1f5f9; }
        .comic-card { background: #111827; border: 3px solid #1e293b; border-radius: 1.5rem; position: relative; overflow: hidden; }
        .comic-card::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(#ffffff10 1px, transparent 1px); background-size: 10px 10px; pointer-events: none; }
        .total-glow { text-shadow: 3px 3px 0px #ef4444, 6px 6px 0px #000; }
        .sidebar-active { background: #3b82f6; color: #fff !important; border: 2px solid #000; box-shadow: 3px 3px 0px #000; }
        [x-cloak] { display: none !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border: 2px solid #000; }
    </style>
</head>
<body x-data="system()" x-init="checkAuth()">

    <div x-show="!isLoggedIn" class="min-h-screen flex items-center justify-center p-4 bg-[#050505] z-[100]" x-transition>
        <div class="comic-card w-full max-w-md p-10 shadow-2xl border-orange-500 text-center bg-[#1a1a1a]">
            <div class="bg-yellow-400 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-black shadow-[4px_4px_0px_#000] -rotate-6 text-3xl">üõ°Ô∏è</div>
            <h2 class="text-4xl font-bold italic text-yellow-400 uppercase mb-2 leading-none" style="-webkit-text-stroke: 1px black;">System Login</h2>
            <div class="space-y-4 text-left mt-8">
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold mb-1 ml-1 block">Username</label>
                    <input type="text" x-model="userInput" placeholder="USER ID" class="w-full bg-white border-2 border-black rounded-xl px-4 py-3 focus:outline-none text-black font-bold shadow-[3px_3px_0px_#000] uppercase">
                </div>
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold mb-1 ml-1 block">Password</label>
                    <input type="password" x-model="passInput" @keyup.enter="login()" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full bg-white border-2 border-black rounded-xl px-4 py-3 focus:outline-none text-black font-bold shadow-[3px_3px_0px_#000] tracking-[0.4em]">
                </div>
                <button @click="login()" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-xl border-2 border-black shadow-[4px_4px_0px_#000] transition-all uppercase italic text-lg mt-4">AUTHORIZE ‚ûú</button>
            </div>
        </div>
    </div>

    <div x-show="showAdminAuth" class="fixed inset-0 flex items-center justify-center p-4 bg-black/90 z-[200]" x-cloak x-transition>
        <div class="comic-card w-full max-w-sm p-8 border-red-600 text-center bg-[#111827]">
            <h3 class="text-2xl font-bold italic text-red-500 uppercase mb-4">‚ö†Ô∏è ADMIN LOCK</h3>
            <input type="password" x-model="adminPassInput" @keyup.enter="verifyAdmin()" placeholder="ADMIN KEY" class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 mb-4 focus:outline-none text-black font-bold tracking-[0.4em] text-center shadow-[3px_3px_0px_#000]">
            <div class="flex space-x-2">
                <button @click="showAdminAuth = false" class="flex-1 py-2 text-gray-500 text-xs font-bold uppercase">Cancel</button>
                <button @click="verifyAdmin()" class="flex-[2] bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg border-2 border-black shadow-[3px_3px_0px_#000] uppercase italic">Verify ‚ûú</button>
            </div>
        </div>
    </div>

    <div x-show="isLoggedIn" x-cloak class="flex h-screen overflow-hidden">
        <aside class="w-80 bg-[#0a0a0a] border-r-4 border-black flex flex-col z-20">
            <div class="p-8">
                <h2 class="text-2xl font-bold text-white italic tracking-wide uppercase leading-none" style="-webkit-text-stroke: 0.5px #3b82f6;">EXCHANGE<br><span class="text-blue-500">REWARD</span></h2>
                <div class="h-1 w-12 bg-red-600 mt-4 border-2 border-black shadow-[2px_2px_0px_#000]"></div>
            </div>

            <div class="px-6 mb-4">
                <div class="bg-gray-900/50 border-2 border-white/5 rounded-xl p-4">
                    <p class="text-[9px] text-gray-500 font-bold uppercase tracking-[0.2em] mb-3 italic">Event Schedule ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≠‡∏ö</p>
                    <div class="space-y-3">
                        <template x-for="event in timeline" :key="event.name">
                            <div class="flex flex-col border-l-2 border-gray-800 pl-3">
                                <span class="text-[10px] font-bold text-gray-300" x-text="event.name"></span>
                                <span class="text-[9px] text-gray-600 font-mono" x-text="event.date"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
            <nav class="flex-1 px-4 py-2 space-y-3 overflow-y-auto">
                <template x-for="box in rewardData" :key="box.id">
                    <button @click="changeTab(box.id)" 
                        :class="activeTab === box.id ? 'sidebar-active' : 'text-gray-500 hover:text-white'"
                        class="w-full flex flex-col px-5 py-4 text-sm rounded-lg transition-all duration-200 group">
                        <div class="flex justify-between w-full mb-1">
                            <span class="text-[10px] font-bold opacity-60 uppercase" x-text="box.id"></span>
                            <span class="text-[9px] font-bold px-2 bg-black/40 rounded italic" x-text="box.total + ' ‡πÅ‡∏•‡∏Å'"></span>
                        </div>
                        <div class="text-left truncate w-full font-bold text-base uppercase italic tracking-tight" x-text="box.title"></div>
                    </button>
                </template>
            </nav>
            <div class="p-6 border-t-2 border-black">
                <button @click="requestAdminAccess()" class="w-full bg-yellow-400 text-black py-3 rounded-xl border-2 border-black font-bold text-xs shadow-[3px_3px_0px_#000] hover:bg-yellow-300 transition-all uppercase italic">‚öôÔ∏è Admin Control</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-[#050505]">
            <header class="bg-[#111827] px-8 py-5 flex justify-between items-center border-b-4 border-black shadow-xl z-30 font-bold">
                <div class="flex items-center space-x-3 italic">
                    <div class="w-3 h-3 bg-red-600 border-2 border-black rotate-45"></div>
                    <h1 class="text-lg font-bold text-white uppercase tracking-wide" x-text="currentPage === 'admin' ? 'ADMIN SETTINGS' : getCurrentBox()?.title"></h1>
                </div>
                <div class="flex items-center space-x-4 uppercase font-bold">
                    <template x-if="currentPage === 'home'"><input type="text" x-model="search" placeholder="SEARCH ITEM..." class="bg-white border-2 border-black rounded-lg px-6 py-2 text-xs text-black w-64 font-bold shadow-[2px_2px_0px_#000]"></template>
                    <button @click="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg text-[10px] font-bold border-2 border-black shadow-[2px_2px_0px_#000] hover:bg-red-500">‚ûú LOGOUT</button>
                </div>
            </header>

            <section x-show="currentPage === 'home'" class="flex-1 p-8 overflow-y-auto space-y-10 scroll-smooth">
                <div class="w-full bg-red-600 rounded-[2rem] p-12 flex flex-col md:flex-row justify-between items-center relative overflow-hidden border-4 border-black shadow-[10px_10px_0px_#000]">
                    <div class="absolute -right-10 -bottom-10 text-[20rem] opacity-20 font-bold italic pointer-events-none uppercase leading-none text-black select-none">DATA</div>
                    <div class="z-10 text-center md:text-left">
                        <h2 class="text-white text-5xl font-bold italic tracking-tight uppercase drop-shadow-[3px_3px_0px_#000]" x-text="getCurrentBox()?.title"></h2>
                        <p class="text-[11px] text-yellow-300 font-bold mt-4 uppercase tracking-[0.3em] bg-black/20 inline-block px-4 py-1 rounded-full border border-yellow-400/20" x-text="getEventDate(getCurrentBox()?.id)"></p>
                    </div>
                    <div class="text-center md:text-right z-10">
                        <span class="text-[10rem] font-bold text-white total-glow tracking-tight block leading-none" x-text="getCurrentBox()?.total.toLocaleString() || 0"></span>
                        <span class="bg-yellow-400 text-black inline-block font-bold uppercase text-[14px] italic border-2 border-black px-4 py-1 shadow-[3px_3px_0px_#000] mt-4">REDEEMS COLLECTED</span>
                    </div>
                </div>

                <div class="comic-card overflow-hidden shadow-[8px_8px_0px_#000] border-black border-2">
                    <table class="w-full text-left font-bold">
                        <thead class="bg-blue-600 border-b-2 border-black uppercase text-white italic tracking-wider text-[11px]">
                            <tr><th class="px-10 py-5">Reward List</th><th class="px-10 py-5 text-center bg-yellow-400 text-black border-l-2 border-black w-44 uppercase">Collected</th></tr>
                        </thead>
                        <tbody class="divide-y-2 divide-black bg-[#161b22]">
                            <template x-for="item in filteredItems()" :key="item.name + item.sys">
                                <tr class="hover:bg-white/5 transition-colors font-bold group">
                                    <td class="px-10 py-6 border-r-2 border-black">
                                        <div class="text-xl font-bold text-white uppercase italic group-hover:text-blue-400" x-text="item.name"></div>
                                        <div class="text-[10px] text-yellow-500 font-mono mt-1 opacity-80 uppercase tracking-tighter" x-text="item.sys"></div>
                                    </td>
                                    <td class="px-10 py-6 text-center text-5xl font-bold text-white italic drop-shadow-[2px_2px_0px_#000]" x-text="item.count"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

                <div class="comic-card p-10 shadow-[8px_8px_0px_#000] border-black border-2 bg-[#0a0a0a]">
                    <h3 class="text-lg font-bold uppercase text-yellow-400 italic mb-8 tracking-widest leading-none">üìä PERFORMANCE ANALYSIS</h3>
                    <div style="height: 450px;"><canvas id="itemChart"></canvas></div>
                </div>
            </section>

            <section x-show="currentPage === 'admin'" class="flex-1 p-8 overflow-y-auto space-y-8" x-cloak>
                <div class="max-w-4xl mx-auto space-y-8">
                    <button @click="currentPage = 'home'" class="text-blue-400 font-bold uppercase text-sm hover:underline italic">‚Üê Back to Dashboard</button>
                    <div class="comic-card p-10 border-blue-500 bg-[#161b22] shadow-[8px_8px_0px_#000] border-2 border-black font-bold">
                        <h3 class="font-bold mb-6 text-blue-400 uppercase text-lg italic tracking-widest">Database Config</h3>
                        <input type="text" x-model="csvUrl" class="w-full bg-white border-2 border-black rounded-xl px-5 py-4 text-xs font-mono text-black mb-4">
                        <button @click="saveUrl" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-5 rounded-xl border-2 border-black shadow-[4px_4px_0px_#000] uppercase italic text-lg transition-all">Save & Update</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function system() {
            return {
                isLoggedIn: false,
                showAdminAuth: false,
                currentPage: 'home',
                activeTab: '',
                search: '',
                userInput: '',
                passInput: '',
                adminPassInput: '',
                masterUsername: 'adminboom',
                masterPassword: '1150',
                adminPassword: '1112',
                rewardData: [],
                csvUrl: localStorage.getItem('rewardCsvUrl') || 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFrdwnCKV_cB0AECX2p47917IPmwoamAqO5ubOz9wbyXMOLA5eiGnKVSIXrW5zEg0PLzMH5903mXtO/pub?gid=0&single=true&output=csv',
                chartInstance: null,

                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Timeline ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤
                timeline: [
                    { id: 'box1', name: 'Powerpufffly 1', date: '3 ‡∏ï.‡∏Ñ. - 7 ‡∏û.‡∏¢. 2025' },
                    { id: 'box2', name: 'Powerpufffly 2', date: '1 ‡∏ò.‡∏Ñ. 2025 - 18 ‡∏°.‡∏Ñ. 2026' },
                    { id: 'box3', name: 'Powerpufffly 3', date: '5 - 8 ‡∏Å.‡∏û. 2026' }
                ],

                getEventDate(boxId) {
                    const event = this.timeline.find(t => t.id === boxId);
                    return event ? event.date : 'Unknown Date';
                },

                checkAuth() { if (sessionStorage.getItem('exchangeAuth') === 'true') { this.isLoggedIn = true; this.fetchData(); } },
                login() {
                    if (this.userInput === this.masterUsername && this.passInput === this.masterPassword) {
                        this.isLoggedIn = true; sessionStorage.setItem('exchangeAuth', 'true'); this.fetchData();
                    } else { alert('USERNAME ‡∏´‡∏£‡∏∑‡∏≠ PASSWORD ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!'); }
                    this.passInput = '';
                },
                requestAdminAccess() { this.showAdminAuth = true; },
                verifyAdmin() {
                    if (this.adminPassInput === this.adminPassword) { this.currentPage = 'admin'; this.showAdminAuth = false; }
                    else { alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!'); }
                    this.adminPassInput = '';
                },
                logout() { this.isLoggedIn = false; sessionStorage.removeItem('exchangeAuth'); this.currentPage = 'home'; },
                saveUrl() { localStorage.setItem('rewardCsvUrl', this.csvUrl); location.reload(); },
                async fetchData() {
                    try {
                        const res = await fetch(this.csvUrl + '&cb=' + Date.now());
                        const data = await res.text();
                        this.rewardData = this.parseCSV(data);
                        if (this.rewardData.length > 0) {
                            if (!this.activeTab) this.activeTab = this.rewardData[0].id;
                            this.$nextTick(() => this.renderChart());
                        }
                    } catch (e) { console.error(e); }
                },
                parseCSV(csv) {
                    const lines = csv.split(/\r?\n/).filter(l => l.trim() !== '');
                    const boxes = {};
                    lines.slice(1).forEach(line => {
                        const cols = line.split(/,(?=(?:(?:[^["]*"){2})*[^"]*$)/);
                        if (cols.length < 5) return;
                        const [boxId, title, itemName, sysName, count] = cols.map(s => s.replace(/"/g, '').trim());
                        if (!boxes[boxId]) boxes[boxId] = { id: boxId, title: title, items: [], total: 0 };
                        const val = parseInt(count) || 0;
                        boxes[boxId].items.push({ name: itemName, sys: sysName, count: val });
                        boxes[boxId].total += val;
                    });
                    return Object.values(boxes);
                },
                getCurrentBox() { return this.rewardData.find(b => b.id === this.activeTab); },
                filteredItems() { 
                    const box = this.getCurrentBox();
                    return box ? box.items.filter(i => i.name.toLowerCase().includes(this.search.toLowerCase())) : [];
                },
                changeTab(id) { this.currentPage = 'home'; this.activeTab = id; this.$nextTick(() => this.renderChart()); },
                renderChart() {
                    const box = this.getCurrentBox();
                    if (!box || this.currentPage !== 'home') return;
                    const ctx = document.getElementById('itemChart').getContext('2d');
                    if (this.chartInstance) this.chartInstance.destroy();
                    this.chartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: box.items.map(i => i.name),
                            datasets: [{
                                data: box.items.map(i => i.count),
                                backgroundColor: ['#ef4444', '#3b82f6', '#facc15', '#fff'],
                                borderColor: '#000',
                                borderWidth: 3,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { grid: { display: false }, ticks: { color: '#fff', font: { family: 'Kanit', size: 12, weight: '500' } } },
                                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>

