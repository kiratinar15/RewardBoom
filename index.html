<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exchangeReward - Comic Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #050505; color: #f1f5f9; }
        
        /* Comic Style Elements */
        .comic-border { border: 4px solid #000; box-shadow: 8px 8px 0px #000; }
        .comic-card { background: #111827; border: 4px solid #1e293b; border-radius: 1rem; position: relative; overflow: hidden; }
        .comic-card::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(#ffffff10 1px, transparent 1px); background-size: 10px 10px; pointer-events: none; }
        
        .total-glow { 
            text-shadow: 4px 4px 0px #ef4444, 8px 8px 0px #000;
        }
        
        .sidebar-active { background: #3b82f6; color: #fff !important; border: 2px solid #000; box-shadow: 4px 4px 0px #000; }
        
        [x-cloak] { display: none !important; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border: 2px solid #000; }
    </style>
</head>
<body x-data="system()">

    <template x-if="currentPage === 'login'">
        <div class="min-h-screen flex items-center justify-center p-4 bg-[#050505]">
            <div class="comic-card w-full max-w-md p-10 shadow-2xl border-orange-500 text-center bg-[#1a1a1a]">
                <div class="bg-yellow-400 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-black shadow-[4px_4px_0px_#000] -rotate-6">
                    <span class="text-3xl">üîë</span>
                </div>
                <h2 class="text-4xl font-black italic text-yellow-400 tracking-tighter uppercase mb-2 leading-none" style="-webkit-text-stroke: 1.5px black;">Admin Login</h2>
                <div class="space-y-4 text-left mt-8">
                    <input type="password" x-model="passInput" placeholder="ENTER CODE" class="w-full bg-white border-4 border-black rounded-lg px-4 py-4 focus:outline-none text-black font-black tracking-[0.5em] shadow-[4px_4px_0px_#000]">
                    <button @click="doLogin" class="w-full bg-red-600 hover:bg-red-500 text-white font-black py-4 rounded-lg border-4 border-black shadow-[6px_6px_0px_#000] transition-all uppercase italic text-xl">Confirm ‚ûú</button>
                    <button @click="currentPage = 'home'" class="w-full py-2 text-gray-500 text-xs hover:text-white transition-colors uppercase font-bold text-center">Back to Home</button>
                </div>
            </div>
        </div>
    </template>

    <template x-if="currentPage === 'admin'">
        <div class="min-h-screen p-8 max-w-5xl mx-auto">
            <header class="flex justify-between items-center mb-12">
                <div class="flex items-center space-x-4">
                    <div class="bg-yellow-400 p-3 rounded-xl border-4 border-black shadow-[4px_4px_0px_#000] font-bold text-black">‚öôÔ∏è</div>
                    <h1 class="text-3xl font-black italic tracking-tighter uppercase text-white">Admin Control</h1>
                </div>
                <button @click="logout" class="bg-red-600 border-4 border-black px-6 py-2 rounded-lg text-xs font-black hover:bg-red-500 shadow-[4px_4px_0px_#000]">‚ûú Logout</button>
            </header>

            <div class="space-y-8">
                <div class="comic-card p-10 border-blue-500 bg-[#161b22]">
                    <h3 class="font-black mb-6 text-blue-400 uppercase tracking-widest text-lg italic">Database Config</h3>
                    <input type="text" x-model="csvUrl" class="w-full bg-white border-4 border-black rounded-xl px-5 py-4 text-xs font-mono text-black mb-4 shadow-[4px_4px_0px_#000]">
                    <button @click="saveUrl" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-xl border-4 border-black shadow-[6px_6px_0px_#000] transition-all uppercase italic tracking-widest text-xl">Save & Update</button>
                </div>

                <div class="comic-card p-10 border-yellow-500 bg-[#1a1a1a] flex justify-between items-center">
                    <div>
                        <p class="text-xl font-black text-yellow-400 mb-1 uppercase italic">Google Sheets Editor</p>
                        <p class="text-xs text-gray-500 font-bold uppercase tracking-widest">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</p>
                    </div>
                    <a href="https://docs.google.com/spreadsheets/d/1fPWt2t4zumgImIgoBWLMyIBO-8YR19eOoCaJzbl3jNw/edit#gid=0" target="_blank" class="bg-yellow-400 hover:bg-yellow-300 text-black px-8 py-4 rounded-xl border-4 border-black font-black text-sm uppercase shadow-[6px_6px_0px_#000] transition-all flex items-center">üåê OPEN SHEET</a>
                </div>
            </div>
        </div>
    </template>

    <template x-if="currentPage === 'home'">
        <div class="flex h-screen overflow-hidden">
            <aside class="w-72 bg-[#0a0a0a] border-r-4 border-black flex flex-col z-20">
                <div class="p-8">
                    <h2 class="text-3xl font-black text-white italic tracking-tighter uppercase leading-none" style="-webkit-text-stroke: 1px #3b82f6;">EXCHANGE<br><span class="text-blue-500">REWARD</span></h2>
                    <div class="h-1 w-12 bg-red-600 mt-4 border-2 border-black"></div>
                </div>
                <nav class="flex-1 px-4 py-4 space-y-3 overflow-y-auto uppercase">
                    <template x-for="box in rewardData" :key="box.id">
                        <button @click="changeTab(box.id)" 
                            :class="activeTab === box.id ? 'sidebar-active' : 'text-gray-500 hover:text-white'"
                            class="w-full flex flex-col px-5 py-4 text-sm rounded-lg transition-all duration-200">
                            <div class="flex justify-between w-full mb-1">
                                <span class="text-[10px] font-black opacity-60 uppercase" x-text="box.id"></span>
                                <span class="text-[10px] font-black italic" x-text="box.total"></span>
                            </div>
                            <div class="text-left truncate w-full font-black tracking-tighter text-lg" x-text="box.title"></div>
                        </button>
                    </template>
                </nav>
            </aside>

            <main class="flex-1 flex flex-col bg-[#050505]">
                <header class="bg-[#111827] px-8 py-5 flex justify-between items-center border-b-4 border-black shadow-xl z-30 font-black">
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-red-600 border-2 border-black rotate-45"></div>
                        <h1 class="text-xl font-black text-white italic tracking-tighter uppercase" x-text="getCurrentBox()?.title || 'Loading...'"></h1>
                    </div>
                    <div class="flex items-center space-x-4 uppercase">
                        <input type="text" x-model="search" placeholder="SEARCH ITEM..." class="bg-white border-4 border-black rounded-lg px-6 py-2 text-xs text-black w-64 placeholder-gray-400 font-bold shadow-[3px_3px_0px_#000]">
                        <button @click="currentPage = 'login'" class="bg-yellow-400 text-black px-4 py-2 rounded-lg text-[10px] font-black tracking-widest border-4 border-black shadow-[3px_3px_0px_#000] hover:translate-y-[-2px] transition-all">üîí ADMIN</button>
                    </div>
                </header>

                <section class="flex-1 p-8 overflow-y-auto space-y-12 scroll-smooth">
                    
                    <div class="w-full bg-red-600 rounded-[2rem] p-16 flex flex-col md:flex-row justify-between items-center relative overflow-hidden border-4 border-black shadow-[15px_15px_0px_#000]">
                        <div class="absolute -right-10 -bottom-10 text-[25rem] opacity-20 font-black italic pointer-events-none tracking-tighter uppercase select-none leading-none text-black">STAT</div>
                        
                        <div class="z-10 text-center md:text-left">
                            <h2 class="text-white text-7xl font-black italic tracking-tighter uppercase leading-tight drop-shadow-[4px_4px_0px_#000]" x-text="getCurrentBox()?.title"></h2>
                            <div class="h-2 w-32 bg-yellow-400 border-2 border-black mt-6 shadow-[3px_3px_0px_#000]"></div>
                        </div>

                        <div class="text-center md:text-right z-10">
                            <span class="text-[15rem] font-black text-white total-glow tracking-tighter block leading-none select-all" x-text="getCurrentBox()?.total.toLocaleString() || 0"></span>
                            <span class="bg-yellow-400 text-black inline-block font-black uppercase text-[18px] tracking-[0.2em] italic border-4 border-black px-4 py-1 shadow-[4px_4px_0px_#000] mt-4">REDEEMS COLLECTED</span>
                        </div>
                    </div>

                    <div class="comic-card overflow-hidden shadow-[10px_10px_0px_#000] border-black border-4">
                        <table class="w-full text-left">
                            <thead class="bg-blue-600 border-b-4 border-black uppercase text-white font-black italic tracking-widest">
                                <tr><th class="px-10 py-6 text-xl">Reward List</th><th class="px-10 py-6 text-center text-xl bg-yellow-400 text-black border-l-4 border-black">Count</th></tr>
                            </thead>
                            <tbody class="divide-y-4 divide-black bg-[#161b22]">
                                <template x-for="item in filteredItems()" :key="item.name + item.sys">
                                    <tr class="hover:bg-white/5 transition-colors group font-black">
                                        <td class="px-10 py-8 border-r-4 border-black">
                                            <div class="text-2xl font-black text-white uppercase tracking-tighter italic group-hover:text-blue-400 transition-all" x-text="item.name"></div>
                                            <div class="text-xs text-yellow-500 font-mono mt-1 opacity-80" x-text="item.sys"></div>
                                        </td>
                                        <td class="px-10 py-8 text-center text-6xl font-black text-white italic drop-shadow-[3px_3px_0px_#000]" x-text="item.count"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <div class="comic-card p-12 shadow-[12px_12px_0px_#000] border-black border-4 bg-[#0a0a0a]">
                        <h3 class="text-2xl font-black uppercase tracking-tighter text-yellow-400 italic mb-10 leading-none">üìä PERFORMANCE ANALYSIS</h3>
                        <div style="height: 500px;"><canvas id="itemChart"></canvas></div>
                    </div>

                </section>
            </main>
        </div>
    </template>

    <script>
        function system() {
            return {
                currentPage: 'home',
                activeTab: '',
                search: '',
                passInput: '',
                rewardData: [],
                csvUrl: localStorage.getItem('rewardCsvUrl') || 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFrdwnCKV_cB0AECX2p47917IPmwoamAqO5ubOz9wbyXMOLA5eiGnKVSIXrW5zEg0PLzMH5903mXtO/pub?gid=0&single=true&output=csv',
                chartInstance: null,
                async init() { await this.fetchData(); },
                doLogin() {
                    if (this.passInput === '123') { this.currentPage = 'admin'; this.passInput = ''; }
                    else { alert('ACCESS DENIED: INCORRECT CODE'); }
                },
                logout() { this.currentPage = 'home'; },
                saveUrl() {
                    localStorage.setItem('rewardCsvUrl', this.csvUrl);
                    location.reload();
                },
                async fetchData() {
                    try {
                        const res = await fetch(this.csvUrl + '&cb=' + Date.now());
                        const data = await res.text();
                        this.rewardData = this.parseCSV(data);
                        if (this.rewardData.length > 0) {
                            if (!this.activeTab) this.activeTab = this.rewardData[0].id;
                            this.$nextTick(() => this.renderChart());
                        }
                    } catch (e) { console.error(e); }
                },
                parseCSV(csv) {
                    const lines = csv.split(/\r?\n/).filter(l => l.trim() !== '');
                    const boxes = {};
                    lines.slice(1).forEach(line => {
                        const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        if (cols.length < 5) return;
                        const [boxId, title, itemName, sysName, count] = cols.map(s => s.replace(/"/g, '').trim());
                        if (!boxes[boxId]) boxes[boxId] = { id: boxId, title: title, items: [], total: 0 };
                        const val = parseInt(count) || 0;
                        boxes[boxId].items.push({ name: itemName, sys: sysName, count: val });
                        boxes[boxId].total += val;
                    });
                    return Object.values(boxes);
                },
                getCurrentBox() { return this.rewardData.find(b => b.id === this.activeTab); },
                filteredItems() { 
                    const box = this.getCurrentBox();
                    return box ? box.items.filter(i => i.name.toLowerCase().includes(this.search.toLowerCase())) : [];
                },
                changeTab(id) { this.activeTab = id; this.$nextTick(() => this.renderChart()); },
                renderChart() {
                    const box = this.getCurrentBox();
                    if (!box) return;
                    const ctx = document.getElementById('itemChart').getContext('2d');
                    if (this.chartInstance) this.chartInstance.destroy();
                    
                    // [üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Vertical Bar Chart ‡πÅ‡∏ö‡∏ö Comic]
                    this.chartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: box.items.map(i => i.name),
                            datasets: [{
                                data: box.items.map(i => i.count),
                                backgroundColor: ['#ef4444', '#3b82f6', '#facc15', '#fff'], // ‡πÅ‡∏î‡∏á ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡∏Ç‡∏≤‡∏ß
                                borderColor: '#000',
                                borderWidth: 4,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { grid: { display: false }, ticks: { color: '#fff', font: { family: 'Kanit', size: 14, weight: 'bold' } } },
                                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b', font: { size: 12 } } }
                            },
                            plugins: { 
                                legend: { display: false },
                                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå Comic ‡πÅ‡∏ó‡πâ‡πÜ)
                            }
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>
